<% layout("layouts/boilerplate")%>
<script>
    $("#countryName.val('<%=user.country.name%>')").attr("selected","selected");

</script>
<div class="row my-3 px-4 mh-100">
    <div class="col-md-8 col-lg-8 mx-auto mh-100">
        <div class=" card shadow rounded px-3 pt-3 mh-100">
            <h4 class="px-2 pt-2 mb-0 pb-0">Settings</h4>
            <p class="px-2 mb-2 text-muted">User: <%=user.displayName%> |  Account created: <%=user.createdAt%></p>
            <div class="row pl-2 pr-4 py-2 mh-100 ">
                <div class="col-4 pr-0 pt-2border-right">
                  <div class="list-group" id="list-tab" role="tablist">
                    <a class="list-group-item list-group-item-action active" id="list-account-list" data-toggle="list" href="#list-account" role="tab" aria-controls="home">
                        <h5><i class="fas fa-user-circle mr-1"></i>  Account Information</h5>
                        <small>Change your account information like username and email address.</small>
                    </a>
                    <a class="list-group-item list-group-item-action" id="list-password-list" data-toggle="list" href="#list-password" role="tab" aria-controls="profile">
                        <h5><i class="fas fa-key small mr-2"></i>  Password</h5>
                        <small>Change your password at any time.</small>
                    </a>
                    <a class="list-group-item list-group-item-action disabled" id="list-download-list" data-toggle="list" href="#list-download" role="tab" aria-controls="download">
                        <h5><i class="fas fa-download small mr-2"></i>Data</h5>
                        <small>Download an archive of your data. (Coming soon!)</small>
                    </a>
                    <a class="list-group-item list-group-item-action disabled" id="list-resources-list" data-toggle="list" href="#list-resources" role="tab" aria-controls="resources" >
                        <h5><i class="fas fa-info small mr-2"></i>Additional Resources</h5>
                        <small>Privacy information & ways to contact us. (Coming soon!)</small>
                    </a>
                    <a class="list-group-item list-group-item-action" id="list-delete-list" data-toggle="list" href="#list-delete" role="tab" aria-controls="delete">
                        <h5><i class="fas fa-user-times small mr-2"></i>Delete Account</h5>
                        <small>Permanently delete your account.</small>
                    </a>
                    
                  </div>
                </div>
      
                <div class="col-8 pl-1 pr-0 pt-2 vh-100 border-top ">
                  <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="list-account" role="tabpanel" aria-labelledby="list-account-list">
                        <div class="px-4">
                            <h5 class="mt-1">Change Account Details</h5>
                            <form action="/settings?_method=PUT" method="POST" class="validated-form" novalidate >
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="username">Username</label>
                                        <input class="form-control" type="text" id="username" name="username" placeholder ="@" value="<%=user.username%>">
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please enter a username.</div>
                                        <small id="" class="text-muted">
                                            <i class="fas fa-exclamation text-danger"></i> Changing your username will end this session and require you to log back in with your new username.
                                        </small>
                                    </div>
                                </div>
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="email">Email</label>
                                        <input class="form-control" type="email" id="email" name="email"  value="<%=user.email%>">
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please enter a valid email.</div>
                                    </div>
                                </div>
                                <div class="form-row mt-3">
                                    <div class=" col-md-6">
                                        <label class="form-label mb-0" for="birthyear">Birth year </label>
                                        <input class="form-control" type="number" id="birthyear" name="birthyear" min="1920" max="2001" placeholder="" value="<%=user.birthyear%>">
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please enter a valid year.</div>
                                    </div>
                                </div> 
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="gender">Gender</label>
                                        <select class="custom-select" id="gender" name="gender" >
                                            <option selected value="<%=user.gender%>">─Please select an option─</option>
                                            <option value="male">male</option>   
                                            <option value="female">female</option>          
                                        </select>
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please select a valid option.</div>
                                    </div>
                                </div>
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="country[name]">Country</label>
                                        <select class="custom-select" id="countryName" name="country[name]" >
                                            <option selected value="<%=user.country.name%>">─Please select an option─</option> 
                                            <%  for (let country of countries) { %>
                                            <option value="<%=country["name"]%>"><%=country["name"]%></option>
                                            <%}%>        
                                        </select>
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please select a valid option</div>
                                    </div>
                                </div>
                                <button class="btn btn-warning mt-3" type="submit">Update</button>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="list-password" role="tabpanel" aria-labelledby="list-password-list">
                        <div class="px-4">
                            <h5 class="mt-1">Change Password</h5>
                            <form action="/settings/password?_method=PUT" method="POST" class="validated-form" novalidate >
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="oldPassword">Old Password</label>
                                        <input class="form-control" type="password" id="oldPassword" name="oldPassword" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,20}$" required>
                                        <div class="invalid-feedback">Please enter a valid password.</div>
                                    </div>
                                </div>
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="newPassword">New Password</label>
                                        <input class="form-control" type="password" id="newPassword" name="newPassword" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,20}$" required>
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please enter a valid password.</div>
                                    </div>
                                </div>
                                <!-- <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="confirmPassword">Confirm New Password</label>
                                        <input class="form-control" type="password" id="confirmPassword" name="confirmPassword" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,20}$" required>
                                        <div class="valid-feedback">Looks good!</div>
                                        <div class="invalid-feedback">Please enter a valid password.</div>
                                    </div>
                                </div>  -->
                                
                                <button class="btn btn-warning mt-3" type="submit">Update</button>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="list-download" role="tabpanel" aria-labelledby="list-download-list">

                    </div>
                    <div class="tab-pane fade" id="list-resources" role="tabpanel" aria-labelledby="list-resources-list">

                    </div>
                    <div class="tab-pane fade" id="list-delete" role="tabpanel" aria-labelledby="list-delete-list">
                        <div class="px-4">
                            <h5 class="alert-heading mt-1 text-danger">Delete Account</h5>
                            <p>This will permanently, irreversibly remove content from your account and delete it from our database. This includes all of your account information, ratings, comments, bookmarks, journals, and data.</p>
                            <form class="d-inline" action="/u/<%=user.username%>?_method=DELETE" method="POST" class="validated-form" novalidate>
                                <div class="form-row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label mb-0" for="password">Password</label>
                                        <input class="form-control" type="password" id="password" name="password" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,20}$" required>
                                        <div class="invalid-feedback">Please enter a valid password.</div>
                                    </div>
                                </div>

                                <button class="btn btn-danger mt-3" type="button" data-toggle="modal" data-target="#deleteAccountModal">Delete Account</button>

                                <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="deleteAccountModalLabel">Are you sure?</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-danger">Delete Account</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                  </div>
                </div>
            </div>
        </div>
    </div>
 </div>

<%- include("../partials/new") %>

