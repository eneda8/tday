<% layout("layouts/boilerplate")%>
    <div class="row py-3 px-4">
        <div class="col-md-8 col-lg-5 mx-auto">
            <div class="bg-white shadow rounded overflow-hidden">
                <div class="px-4 pt-0 pb-4 cover" style="background-color: <%=user.coverColor%>">
                    <div class="media align-items-end" style="transform: translateY(6rem)">
                        <div class="mr-3">
                            <img src="<%=user.avatar.path%>" alt="" width="200" height="200" class="rounded my-3 img-thumbnail">
                            <% if(currentUser && user._id.equals(currentUser._id)) { %>
                            <a href=""" data-toggle="modal" id="editProfileLink" data-target="#editProfileModal" class="btn btn-outline-dark btn-sm btn-block">Edit profile</a>
                            <% } %> 
                        </div>
                        <div class="mb-5 text-white">
                            <h4 class="my-1"><%=user.displayName%></h4>
                            <h6 class="py-1">@<%=user.username%></h6>
                            <p class="small mb-5"><img src="/images/pin.png" alt="">  <img src="<%=user.country.flag%>"></p>
                        </div>
                    </div>
                </div>
                <div class="bg-light p-3 d-flex justify-content-end text-center">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=postCount%></h5><small class="text-muted">Posts</small>
                        </li>
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=commentCount%></h5><small class="text-muted">Comments</small>
                        </li>
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block">14</h5><small class="text-muted">Streak</small>
                        </li>
                    </ul>
                </div>
                <div class="px-4 py-3">
                    <h5 class="my-1">About</h5>
                    <div class="p-4 rounded shadow-sm bg-light">
                        <p class="font-italic mb-0"><%=user.bio%></p>
                    </div>
                </div>
                <div class="py-4 px-4">
                    <h5 class="mb-0">Recent posts</h5>
                    <%for (post of user.posts) { %> 
                        <div class="card mb-3 mt-1 pt-2 pl-2">
                            <div class="media pr-3">
                                <img src="<%=user.avatar.thumbnail%>" class="pr-2" alt="" style="width: 45px; border-radius: 50%">
                                <div class="media-body">
                                    <p class="card-subtitle mt-1"><strong><%=user.displayName%></strong><span class="text-muted">@<%=user.username%></span></p>
                                    <p class="mb-1 mt-0 "><%=post.date%>: <span class="star star<%=post.rating%>-result"></span></p>
                                    <div class="text-wrap">
                                        <p class="my-0"><%=post.body%></p>
                                    </div>
                                    <% if(post.image) { %> 
                                        <div class="d-block">
                                            <img class="img-fluid" src="<%=post.image.fullsize%>" alt="">
                                        </div>
                                    <% } %> 
                                    <div class="d-inline">
                                        <small class="pb-1"><%=post.timestamp%></small>
                                        <% if(post.edited){ %>
                                        <small class="pb-1 text-muted">Edited</small>
                                        <% } %>
                                    </div>
                                    <div class="d-block">
                                        <small class="mr-3"><a href="/posts/<%=post._id%>" class="card-link">Comments</a></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %> 
                </div>
            </div>
        </div>
    </div>

<!-- Edit profile modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="editProfileLableModal">Edit Profile</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form action="/settings?_method=PUT" method="POST" class="validated-form" novalidate enctype="multipart/form-data">
            <div>
                <form action="/settings?_method=PUT" method="POST" class="validated-form" novalidate enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label" for="displayName">Display name</label>
                        <input class="form-control" type="text" id="displayName" name="displayName" value="<%=user.displayName%>">
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="bio">Bio</label>
                        <textarea class="form-control" id="bio" name="bio"><%=user.bio%></textarea>
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                    </div>
                    <p>Profile photo:</p>
                    <div class="custom-file mb-3">
                        <input type="file" class="custom-file-input" id="avatar" name="avatar" onchange="document.getElementById('preview').src = window.URL.createObjectURL(this.files[0])">
                        <label class="custom-file-label" for="avatar">Choose an image...</label>
                    </div>
                    <img class="img-fluid my-2" id="preview" width="100px"/> 
                    <div class="mb-3">
                        <label for="coverColor">Profile cover color:</label>
                        <input type="color" name="coverColor" id="coverColor" value="<%=user.coverColor%>">
                    </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
            </form>
        </div>
        </div>
    </div>
    </div>