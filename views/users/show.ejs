<% layout("layouts/boilerplate")%>
    <div class="row py-3 px-4">
        <div class="col-md-8 col-lg-5 mx-auto">
            <div class="bg-white shadow rounded overflow-hidden">
                <% if(user.coverPhoto) { %> 
                <div class="px-4 pt-0 cover" style="background-image: url('<%=user.coverPhoto.path%>'); height: 350px;">
                <% } else {%> 
                <div class="px-4 pt-0 pb-4 cover" style="background-color: <%=user.coverColor%>;">
                <% } %> 
                    <div class="media align-items-end" style="transform: translateY(10rem)">
                        <div class="mr-3">
                            <a href="" data-toggle="modal" id ="avatarPreviewLink" data-target="#avatarPreviewModal">
                                <img src="<%=user.avatar.path%>" alt="" width="200" height="200" class="rounded-circle my-3 img-fluid img-thumbnail">
                            </a>
                            <% if(currentUser && user._id.equals(currentUser._id)) { %>
                            <a href="" data-toggle="modal" id="editProfileLink" data-target="#editProfileModal" class="btn btn-warning btn-sm btn-block">Edit profile <i class="fas fa-user-edit"></i></a>
                            <% } %> 
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mt-0" style="transform: translateY(-5rem)">
                        <div class="ml-3 text-black">
                            <h4 class="my-1 p-2 font-weight-bold"  style="background-color: rgba(255,255,255, .6);"><%=user.displayName%></h4>
                            <h6 class="p-2 font-weight-bold"  style="background-color: rgba(255,255,255, .6);">@<%=user.username%></h6>
                            <p class="small mb-5 p-2 font-weight-bold"  style="background-color: rgba(255,255,255, .6);"><i class="fas fa-map-marker-alt text-primary mr-1"></i>  <img class="mr-2" title="<%=user.country.name %>" src="<%=user.country.flag%>"><%=user.country.name %></p>
                        </div>
                    </div>
                </div>
                <div class="bg-light p-3 d-flex justify-content-end text-center">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=user.posts.length%></h5><small class="text-muted">Ratings</small>
                        </li>
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=user.comments.length%></h5><small class="text-muted">Comments</small>
                        </li>
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=user.postStreak%></h5><small class="text-muted">Streak</small>
                        </li>
                        <% if(currentUser && user._id.equals(currentUser._id)) { %>
                        <li class="list-inline-item">
                            <h5 class="font-weight-bold mb-0 d-block"><%=user.average%></h5><small class="text-muted">Avg. Rating</small>
                        </li>
                        <% } %> 
                    </ul>
                </div>
                <div class="px-4 py-3">
                    <h6 class="my-1 font-weight-bold">About</h6>
                    <div class="py-3 pl-2 rounded shadow-sm bg-light">
                        <p class="text-dark mb-0"><%=user.bio%></p>
                    </div>
                </div>
                <nav>
                    <div class="nav nav-tabs mx-4" id="nav-tab" role="tablist">
                      <a class="nav-link active" id="nav-posts-tab" data-toggle="tab" href="#nav-ratings" role="tab" aria-controls="nav-ratings" aria-selected="true" data-toggle="tab" data-tab-history="true" data-tab-history-changer="push" data-tab-history-update-url="true">Ratings</a>
                      <a class="nav-link" id="nav-comments-tab" data-toggle="tab" href="#nav-comments" role="tab" aria-controls="nav-comments" aria-selected="false" data-toggle="tab" data-tab-history="true" data-tab-history-changer="push" data-tab-history-update-url="true">Comments</a>
                      <% if(currentUser && user._id.equals(currentUser._id)) { %>
                      <a class="nav-link" id="nav-data-tab" data-toggle="tab" href="#nav-data" role="tab" aria-controls="nav-data" aria-selected="false" data-tab-history="true" data-tab-history-changer="push" data-tab-history-update-url="true">Data</a>
                      <a class="nav-link" id="nav-bookmarks-tab" data-toggle="tab" href="#nav-bookmarks" role="tab" aria-controls="nav-bookmarks" aria-selected="false" data-tab-history="true" data-tab-history-changer="push" data-tab-history-update-url="true">Bookmarks</a>
                      <a class="nav-link" id="nav-journals-tab" data-toggle="tab" href="#nav-journals" role="tab" aria-controls="nav-journals" aria-selected="false" data-tab-history="true" data-tab-history-changer="push" data-tab-history-update-url="true">Journals</a>
                      <% } %> 
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <%- include("../partials/userProfile/tabs/ratings") %>
                    <%- include("../partials/userProfile/tabs/comments") %>
                    <!-- AUTHORIZED TABS -->
                    <% if(currentUser && user._id.equals(currentUser._id)) { %> 
                    <%- include("../partials/userProfile/tabs/data") %>
                    <%- include("../partials/userProfile/tabs/bookmarks")%>
                    <%- include("../partials/userProfile/tabs/journals")%>
                    <%} %> 
                </div>
            </div>
        </div>
</div>

<%- include("../partials/userProfile/modals/editProfile") %>
<%- include("../partials/userProfile/modals/avatarPreview") %>
<%- include("../partials/userProfile/modals/editTodayAndYesterday") %>

