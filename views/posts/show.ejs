<% layout("layouts/boilerplate")%>

<div class="row py-3 px-4">
  <div class="col-md-8 col-lg-5 mx-auto my-auto bg-light rounded shadow-sm">
    <%- include("../partials/posts") %>
    <div id="commentDiv" class="bg-white p-3 mb-3">
      <h6 class="mb-0 pb-2 border-bottom">Comments</h6>
      <% for (let comment of post.comments) { %>
          <div class="media mb-1 pl-4 py-2 shadow-sm">
            <a class="mr-3" href="/u/<%=comment.author.username%>">
              <img src="<%=comment.author.avatar.thumbnail%>" alt="" style="width:40px; border-radius: 50%">
            </a>
            <div class="media-body">
              <h6 class="my-0 card-subtitle d-inline"><strong><a href="/u/<%=comment.author.username%>"><%=comment.author.displayName%></a></strong>  <img class="d-inline" style="width: 17px" src="<%=comment.author.country.flag%>" title="<%=comment.author.country.name%>" alt=""></h6>
                <small class="text-muted mb-1 d-block">@<%=comment.author.username%></small>
                <p class="my-1"><%=comment.body%></p>
                <small class="pb-1"><%=comment.timestamp%></small>
                <% if(currentUser && comment.author.equals(currentUser._id)) { %> 
                  <button class="btn btn-link btn-sm d-inline pb-0" title="Delete comment" data-toggle="modal" data-target="#commentDeleteModal-<%=comment._id%>"><i class="fas fa-trash-alt text-danger"></i></button>
                  <div class="modal fade" id="commentDeleteModal-<%=comment._id%>" tabindex="-1" aria-labelledby="commentDeleteModalLabel-<%=comment._id%>" aria-hidden="true">
                    <div class="modal-dialog modal-sm modal-dialog-centered">
                        <div class="modal-content">
                            <div class="d-flex justify-content-end pr-2 pb-0 mb-0">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-header border-0 pb-1 pt-0">
                                <h6 class="modal-title font-weight-bold d-block" id="commentDeleteModalLabel">Delete comment?</h6>
                            </div>
                            <div class="modal-body py-1">
                                <p class="mb-0">Are you sure? This can't be undone.</p>
                              </div>
                            <div class="modal-footer pt-1 border-0">
                                <button type="button" class="btn btn-warning btn-sm" data-dismiss="modal">Cancel</button>
                                <% if(comment.post) { %> 
                                <form class="d-inline" action="/posts/<%=comment.post._id%>/comments/<%=comment._id%>?_method=DELETE" method="POST">
                                <% } else { %> 
                                <form class="d-inline" action="/comments/<%=comment._id%>?_method=DELETE" method="POST">
                                <% } %> 
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>    
                <% } %> 
            </div>
          </div>  
          <div>
            
        <% } %>
    </div>
  </div>
</div>

<%- include('../partials/posts/edit')%>



