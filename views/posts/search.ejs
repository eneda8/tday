<% layout("layouts/boilerplate")%>
<div class="container-fluid mb-4">
    <h4 class="font-weight-bold mb-0 mt-4 ml-5">Search</h4>
    <div class="row px-4 mx-auto">
        <div class="col-md-3 col-lg-3">
            <div class="bg-light p-4">
                <%- include("../partials/searchFilter") %>
            </div>
            
        </div>
        <div class="col-md-6 col-lg-6 bg-light overflow-auto" id="searchResults">
            <% if( posts && posts.docs){ %>
                <div class="d-flex justify-content-between">
                    <h5 class="text-left mt-3 mb-0">Results</h5>
                    <a href="#" class="small pt-3" onclick="myHilitor.remove(); this.classList.add('d-none')">Clear highlighting</a>
                </div>
            <span class="small text-muted mt-0"><%=docsFound %> ratings found </span> 
                <%- include("../partials/paginate")%>
                <%for (post of posts.docs) { %> 
                    <div class="card mb-3 mt-1 pt-2 pl-2 pr-2 border-0">
                        <div class="media pr-3">
                            <a href="/u/<%=post.author.username%>"><img style="width:45px; border-radius: 50%" src="<%=post.author.avatar.thumbnail%>" class="pr-2" alt=""></a>
                            <div class="media-body text-wrap">
                                <div class="d-flex justify-content-between mt-2">
                                    <p class="card-subtitle mb-1 d-inline"><strong><a href="/u/<%=post.author.username%>"><%=post.author.displayName%></a></strong>  <img class="d-inline" style="width: 17px" src="<%=post.author.country.flag%>" title="<%=post.author.country.name%>" alt=""><small class="text-muted mb-1 d-block">@<%=post.author.username%></small></p>
                                    
                                    <% if(user && post.author.equals(user._id)) { %> 
                                        <div class="btn-group" title="More" >
                                        <button class="btn btn-sm text-dark mb-1 pb-1 bg-light rounded-circle" data-toggle="dropdown" style="height: 30px; width: 30px">...</button>
                                        <div class="dropdown-menu dropdown-menu-lg-right">
                                            <% if(within24Hours(post) === true) { %>
                                            <button class="dropdown-item pl-2"><a href="" data-toggle="modal" id="editPostLink" data-target="#editPostModal" class="text-decoration-none"><i class="fas fa-edit text-warning"></i> Edit</a></button>
                                            <% } %> 
                                            <button class="dropdown-item pl-2 text-primary " data-toggle="modal" data-target="#deleteModal-<%=post._id%>"><a><i class="fas fa-trash-alt text-danger"></i><span class="text-light">_</span>Delete</a></button>
                                        </div>
                                        </div>
                                        <% } %>
                                </div>
                                <span class="badge badge-light mb-2" style="font-size: 13px"><%=post.date%>: <span class="star star<%=post.rating%>-result"></span></span>  
                                <div class="text-wrap">
                                    <p class="mb-0 postBody"><%=post.body%></p>
                                </div>
                                <% if(post.image) { %> 
                                    <a href="" data-toggle="modal" id ="imagePreviewLink-<%=post._id%>" data-target="#imagePreviewModal-<%=post._id%>">
                                        <img class="img-fluid" src="<%=post.image.fullsize%>" alt="">
                                    </a>
                                    <!-- image preview modal -->
                                    <div>
                                        <div class="modal fade" id="imagePreviewModal-<%=post._id%>" tabindex="-1" aria-labelledby="imagePreviewModal-<%=post._id%>" aria-hidden="true" >
                                            <div class="modal-dialog modal-dialog-centered">
                                                <img src="<%=post.image.fullsize%>" alt="" class="">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- ------------------------------ -->
                                    
                                <% } %> 
                                <div class="d-flex justify-content-between">
                                    <div>
                                    <small class="pb-1"><a href="/posts/<%=post._id%>" class="card-link"><%=post.timestamp%></a></small>
                                    <% if(post.edited){ %>
                                    <small class="pb-1 text-muted" title="<%=post.updatedAt%>">Edited</small>
                                    <% } %>
                                    </div>
                                    <div>
                                        <a href="/posts/<%=post._id%>" class="text-decoration-none mr-2 p-0" title="Comments"><span class="text-muted" style="font-size: 13px;"><%=post.comments.length%></span> <i class="fas fa-comments text-primary"></i></a>  

                                        <a  class="copy btn btn-sm btn-link " role="button"  title="Copy link"  ><i class="fas fa-link text-warning mr-2" onclick="navigator.clipboard.writeText(window.location.href.slice(0,21)+'/posts/<%=post._id%>')"></i></a>

                                        <% if(user.bookmarks.includes(post._id)) { %>
                                            <button class="btn btn-sm btn-link" title="Remove bookmark" data-toggle="modal" data-target="#bookmarkDeleteModal-<%=post._id%>"><i class="fas fa-bookmark text-danger"></i></button>

                                            <!-- bookmark delete modal -->
                                            <div class="modal fade" id="bookmarkDeleteModal-<%=post._id%>" tabindex="-1" aria-labelledby="bookmarkDeleteModalLabel-<%=post._id%>" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="bookmarkDeleteModalLabel-<%=post._id%>">Remove bookmark?</h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
                                                        <form class="d-inline" action="/posts/<%=post._id%>/bookmark?_method=DELETE" method="POST">
                                                            <button type="submit" class="btn btn-danger">Remove</button>
                                                        </form>
                                                    </div>
                                                </div>
                                                </div>
                                            </div>

                                        <%} else { %> 
                                        <form action="/posts/<%=post._id%>/bookmark" method="POST" class="d-inline">
                                            <button class="btn btn-sm btn-link" title="Bookmark"><i class="far fa-bookmark text-danger mr-2"></i></button>
                                        </form>
                                        <% } %> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        <%- include("../partials/postDelete") %>
                        <hr class="my-1">
                        <div class="media mt-1 mb-2 pl-2">
                            <a class="mr-1" href="/u/<%=user.username%>">
                            <img src="<%=user.avatar.thumbnail%>" alt="" class="border" style="width:40px; border-radius: 50%">
                            </a>
                            <div class="media-body ">
                                <form action="/posts/<%=post._id %>/comments" class="validated-form mr-2" method="POST" novalidate>
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0" name="comment[body]" id="body" cols="15" rows="1" placeholder="Write a comment..." required>
                                        <div class="input-group-append" id="">
                                        <button class="btn btn-warning" type="submit">Post</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <% } %> 
                    <%- include("../partials/paginate")%>
            <% } else { %>
                <h5 class="text-left mt-3 mb-0">Results</h5>
                <span class="small text-muted mt-0">0 ratings found </span> 
                <p class="text-left mt-4">Submit the search form to find ratings.</p>
            <% } %>
        </div>
        <div class="col-md-3 col-lg-3">
            <div class="" style="height: 200px;">
                    <div class="bg-light shadow-sm rounded overflow-hidden" >
                        <div class="px-4 pt-0 pb-4 cover" style="background-color: <%=user.coverColor%>; height: 130px">
                            
                            <div class="media align-items-end">
                                <div class="mr-3">
                                    <img src="<%=user.avatar.path%>" alt="" width="120" height="120" class="rounded-circle my-3 img" style="transform: translateY(2.3rem)">
                                </div>
                                <div class="text-white pl-2 pb-2">
                                    <h4 class="my-0"><a href="/u/<%=user.username%>" class="text-decoration-none text-white"><%=user.displayName%></a></h4>
                                    <p class="my-0"><span style="font-size: 10px"> @</span><%=user.username%></p>
                                    <p class="small"><i class="fas fa-map-marker-alt text-white"></i>  <img title="<%=user.country.name %>" src="<%=user.country.flag%>" width="17px"></p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-light text-dark py-3 pr-3 pl-0 d-flex justify-content-end text-center">
                            <ul class="list-inline mb-0">
                                <li class="list-inline-item">
                                    <h5 class="font-weight-bold mb-0 d-block"><%=user.posts.length%></h5><small class="text-muted">Ratings</small>
                                </li>
                                <li class="list-inline-item">
                                    <h5 class="font-weight-bold mb-0 d-block"><%=user.comments.length%></h5><small class="text-muted">Comments</small>
                                </li>
                                <li class="list-inline-item">
                                    <h5 class="font-weight-bold mb-0 d-block"><%=user.postStreak%></h5><small class="text-muted">Streak</small>
                                </li>
                                <li class="list-inline-item">
                                    <h5 class="font-weight-bold mb-0 d-block"><%=user.average%></h5><small class="text-muted">Avg. Rating</small>
                                </li>
                            </ul>
                        </div>
                    </div>
            </div>
           
        <div class="bg-light shadow-sm rounded my-5 p-3">
            <div class="card my-2 border-0" style="height: 100px;">
                <div class="card-body ">
                    MY DATA
                </div>
            </div>
        </div>
        <div class="bg-light shadow-sm rounded p-3">
            <div class="card my-2 border-0">
                <div class="card-body ">
                    <h6 class="font-weight-bold">Donate to todei</h6>
                    <small class="d-block">We are 100% funded by our users. If you <i class="fas fa-heart text-danger"></i> us, please consider making a donation to cover our operational expenses.</small>
                    <a href="/donate" class="donate btn btn-sm btn-warning mt-2" role="button">Donate</a>
                    <small class="d-block mt-2">Or, support us on Patreon!</small>
                    <a href="" class="donate btn btn-sm btn-danger mt-2 border-0" role="button">Become a Patron <i class="fas fa-external-link-alt small"></i></a>
                </div>
            </div>
        </div>
        <div class="mt-4">
            <div class="text-muted" style="height: 150px;">
                <a class="d-inline text-muted font-weight-light" href="#" style="font-size: 11px">About</a> |
                <a class="d-inline text-muted font-weight-light" href="#" style="font-size: 11px">Privacy Policy</a> |
                <a class="d-inline text-muted font-weight-light" href="#" style="font-size: 11px">Terms of Service</a> |
                <a class="d-inline text-muted font-weight-light" href="#" style="font-size: 11px">Help</a> |
                <a class="d-inline text-muted font-weight-light" href="#" style="font-size: 11px">Contact</a>
                <small class="text-muted d-block">© 2021 todei</small>
                <small class="text-muted d-block">made with <i class="fas fa-heart text-danger"></i> by <a href="https://github.com/eneda8">eneda</a></small>
            </div>
        </div>
    </div>
</div>

<%- include("../partials/new")%>
